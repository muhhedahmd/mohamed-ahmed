{% assign parent_product = block.settings.product %}


{%- if block.settings.product != null -%}
  <div
    class="product-item"
    data-product-id="{{ block.settings.product.id }}"
    data-handle="{{ block.settings.product.handle }}"
    {{ block.shopify_attributes }}
    style="position: relative; width: fit-content; ">

    {% content_for 'blocks' %}
    <img
      src="{{ block.settings.product.featured_image | img_url : '800x' }}"
      height="432"
      width="444"
      class="product-image"
      loading="lazy"
      alt="{{ product.title }}">
  </div>
{%- else -%}

  <div
    class="product-item placeholder"
    {{ block.shopify_attributes }}
    style="position: relative; width: fit-content; ">

    {{ "product-1" | placeholder_svg_tag }}


  </div>

{%- endif -%}


<script type="application/json" id="product-data-{{ block.settings.product.id}}">
    {
      "id": {{ block.settings.product.id }},
      "title": {{ block.settings.product.title | json }},
      "handle": {{ block.settings.product.handle | json }},
      "options": {{ block.settings.product.options | json }},
      "featured_image": "{{ block.settings.product.featured_image | image_url: width: 160, height: 140  }}",
      "price" : "{{ block.settings.product.price  |  money}}",
      "options_with_values": {{ block.settings.product.options_with_values | json }},
        "description" : "{{ block.settings.product.description | strip_html }}",
      "variants": [
    {% for v in block.settings.product.variants %}
      {
        "id": {{ v.id }},
        "title": {{ v.title | json }},
        "options": {{ v.options | json }},
        "available": {{ v.available | json }},
        "price": {{ v.price }},
        "price_formatted": {{ v.price | money | json }},
        "compare_at_price": {{ v.compare_at_price | default: 'null' }},
        "compare_at_price_formatted": {{ v.compare_at_price | money | json |  default: null }}
      }{% unless forloop.last %},{% endunless %}
    {% endfor %}
      ]
    }
</script>


<style>
  .ecom-product {
    width: 100%;
    height: 100%;
    display: flex;
    justify-items: center;
    align-items: center;
  }
  .placeholder {
    overflow: hidden;
    width: 100%;
    height: 100%;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    min-height: 400px;
  }
  .placeholder svg {
    width: 100%;
    height: 100%;
    max-width: 50rem;
    max-height: 50rem;
  }

  @media (max-width: 992px) {
    .placeholder svg {
      max-width: 20rem;
      max-height: 30rem;
    }

    .placeholder {
      min-height: 300px;
    }
  }
</style>

{% schema %}
  {
    "name": "ecom-product.name",
    "tag": "section",
    "class": "ecom-product",
    "blocks": [
      { // "name": "ecom-dialog-product",
        "type": "ecom-dialog-product"

      }
    ],
    "settings": [
      {
        "type": "product",
        "label": "product",
        "id": "product"

      }
    ],
    "presets": [
      {
        "name": "ecom-product.name",
        "settings": {}
      }
    ]
  }
{% endschema %}